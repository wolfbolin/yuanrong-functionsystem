From dfd62d61e2a60c04a91a8f9b2cf0f48afc40866a Mon Sep 17 00:00:00 2001
Date: Tue, 11 Feb 2025 15:09:34 +0800
Subject: [PATCH] [Backport] fix CVE-2025-0167 for curl 8.8.0.
CVE: CVE-2025-0167
Reference:https://github.com/curl/curl/commit/0e120c5b925e8ca75d5319e319e5ce4b8080d8eb
---
 lib/netrc.c | 15 ++++++++++-----
 1 file changed, 10 insertions(+), 5 deletions(-)

diff --git a/lib/netrc.c b/lib/netrc.c
index ed57e98..c12c765 100644
--- a/lib/netrc.c
+++ b/lib/netrc.c
@@ -259,11 +259,16 @@ static int parsenetrc(const char *host,
 
 out:
     Curl_dyn_free(&buf);
-    if(!retcode && !password && state_our_login) {
-      /* success without a password, set a blank one */
-      password = strdup("");
-      if(!password)
-        retcode = 1; /* out of memory */
+    if(!retcode) {
+      if(!password && state_our_login) {
+        /* success without a password, set a blank one */
+        password = strdup("");
+        if(!password)
+          retcode = 1; /* out of memory */
+      }
+      else if (!login && !password)
+        /* a default with no credentials */
+        retcode = NETRC_FILE_MISSING;
     }
     if(!retcode) {
       /* success */
-- 
2.1.4

