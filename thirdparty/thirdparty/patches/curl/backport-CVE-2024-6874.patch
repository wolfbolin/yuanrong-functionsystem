From 8d200191f286ac3ea4eb4d9176f25da12e035d6c Mon Sep 17 00:00:00 2001
Date: Mon, 26 Aug 2024 16:11:45 +0800
Subject: [PATCH] [Backport] fix CVE-2024-6874 for curl 8.8.0.
CVE: CVE-2024-6874
Reference:https://github.com/curl/curl/commit/686d54baf1df6e0775
---
 lib/idn.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/idn.c b/lib/idn.c
index c795672..ef88689 100644
--- a/lib/idn.c
+++ b/lib/idn.c
@@ -65,7 +65,7 @@ static CURLcode mac_idn_to_ascii(const char *in, char **out)
     UIDNAInfo info = UIDNA_INFO_INITIALIZER;
     char buffer[256] = {0};
     (void)uidna_nameToASCII_UTF8(idna, in, -1, buffer,
-      sizeof(buffer), &info, &err);
+                                 sizeof(buffer) - 1, &info, &err);
     uidna_close(idna);
     if(U_FAILURE(err)) {
       return CURLE_URL_MALFORMAT;
@@ -91,7 +91,7 @@ static CURLcode mac_ascii_to_idn(const char *in, char **out)
     UIDNAInfo info = UIDNA_INFO_INITIALIZER;
     char buffer[256] = {0};
     (void)uidna_nameToUnicodeUTF8(idna, in, -1, buffer,
-      sizeof(buffer), &info, &err);
+                                  sizeof(buffer) - 1, &info, &err);
     uidna_close(idna);
     if(U_FAILURE(err)) {
       return CURLE_URL_MALFORMAT;
-- 
2.1.4

